<div id="recipe_ratings" class="text-center">

  <h5 class="mb-3">Oceny</h5>

  <% if @recipe.ratings.any? %>
    <div class="d-flex justify-content-center align-items-center gap-3 mb-4">
      <div class="fs-4 fw-bold text-warning">
        <%= @recipe.average_rating %>
      </div>
      <div class="text-muted">
        (<%= count = @recipe.ratings.count %>

        <%= case count
            when 0 then "ocen"
            when 1 then "ocena"
            when 2..4 then "oceny"
            else "ocen"
            end %>)
      </div>
    </div>
  <% else %>
    <p class="text-muted mb-4">Ten przepis nie ma jeszcze ocen.</p>
  <% end %>

  <% if logged_in? %>
    <% if @recipe.user == current_user %>
      <p class="text-muted fst-italic small">
        Nie możesz oceniać własnego przepisu
      </p>
    <% else %>
      <% user_rating = @recipe.ratings.find_by(user: current_user) %>

      <%= form_with model: [@recipe, (user_rating || Rating.new)],
                    url: rate_recipe_path(@recipe),
                    method: :post,
                    data: { turbo_frame: "recipe_ratings" },
                    class: "d-flex justify-content-center align-items-center gap-2" do |f| %>

        <label class="form-label mb-0">Twoja ocena:</label>

        <%= f.select :rating,
                     options_for_select((1..5).to_a.reverse, selected: user_rating&.rating),
                     { prompt: false },
                     class: "form-select w-auto" %>

        <%= f.submit user_rating ? "Zmień ocenę" : "Oceń",
                     class: "btn btn-warning btn-sm text-white" %>
      <% end %>
    <% end %>
  <% else %>
    <p class="text-muted small">
      <%= link_to "Zaloguj się", login_path, class: "text-danger fw-bold" %>
      aby ocenić przepis
    </p>
  <% end %>
</div>
